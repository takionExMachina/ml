import numpy
import sklearn
import pandas
from sklearn.feature_selection import SelectFromModel
from sklearn.ensemble import ExtraTreesClassifier
from sklearn.model_selection import train_test_split
from sklearn import cross_validation
from sklearn.metrics import confusion_matrix

malware_dataset = pandas.read_csv('malware_dataset/MalwareData.csv', sep='|')
legit = malware_dataset[0:41323].drop(['legitimate'], axis=1)
malware = malware_dataset[41323::].drop(['legitimate'], axis=1)

data = malware_dataset.drop(['Name', 'md5', 'legitimate'], axis=1).values
target = malware_dataset['legitimate'].values
feat_select = ExtraTreesClassifier().fit(data, target)
model = SelectFromModel(feat_select, prefit=True)
data_new = model.transform(data)
legit_train, legit_test, malware_train, malware_test = cross_validation.train_test_split(data_new, target, test_size=0.2)
clf = sklearn.ensemble.GradientBoostingClassifier(n_estimators=50)
clf.fit(legit_train, malware_train)
score = clf.score(legit_test, malware_test)
print("Score: ", score*100)

result = clf.predict(legit_test)
cm = confusion_matrix(malware_test, result)
print("FP: %f %%" % ((cm[0][1]/float(sum(cm[0])))*100))
print("FN: %f %%" % ((cm[1][0]/float(sum(cm[1])))*100))

